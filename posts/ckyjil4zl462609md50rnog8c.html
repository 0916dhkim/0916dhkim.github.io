<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="description" content="Generated by create next app"/><link rel="icon" href="/favicon.ico"/><title>Using Prisma in a Monorepo</title><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/130c6baf48016107.css" as="style"/><link rel="stylesheet" href="/_next/static/css/130c6baf48016107.css" data-n-g=""/><link rel="preload" href="/_next/static/css/1f8cd9067b3ccab7.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1f8cd9067b3ccab7.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-45f9f9587e6c08e1.js" defer=""></script><script src="/_next/static/chunks/framework-c4190dd27fdc6a34.js" defer=""></script><script src="/_next/static/chunks/main-8108a23e93cece3b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-79ab906e136a7a68.js" defer=""></script><script src="/_next/static/chunks/177-c6044defbb4de89f.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-e1b925efe04c4b9e.js" defer=""></script><script src="/_next/static/R2Z8peCXLRCkEcq9IzhX1/_buildManifest.js" defer=""></script><script src="/_next/static/R2Z8peCXLRCkEcq9IzhX1/_ssgManifest.js" defer=""></script><script src="/_next/static/R2Z8peCXLRCkEcq9IzhX1/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="tnpr8r0"><header class="_1y3fg750"><a href="/"><h1>danny.blog</h1></a></header><main class="tnpr8r1"><h1 class="_27wpsv0">Using Prisma in a Monorepo</h1><div class="_27wpsv1"><p>Prisma is an amazing ORM for TypeScript that allows you to access database in a completely type-safe way.
The developer experience Prisma provides can&#x27;t be compared to anything else. In this article, you will learn how to use Prisma in a monorepo.</p>
<h1>Brief Overview of How Prisma Works</h1>
<p>There are two major concept in Prisma: <a href="https://www.prisma.io/docs/concepts/components/prisma-schema">schema</a> and <a href="https://www.prisma.io/docs/concepts/components/prisma-client">client</a></p>
<ul>
<li>Prisma schema is a text file describing the data models and database configurations. It looks like this:<!-- -->
<pre><code>datasource db {
  url      = env(&quot;DATABASE_URL&quot;)
  provider = &quot;postgresql&quot;
}

generator client {
  provider = &quot;prisma-client-js&quot;
}

model Contact {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  email     String   @unique
  name      String?
}
</code></pre>
</li>
<li>From schema, Prisma generates a package called <code>@prisma/client</code> which provides type-safe interface to your models.<!-- -->
<pre><code>import {PrismaClient} from &#x27;@prisma/client&#x27;;
const prisma = new PrismaClient();

// This is inferred as `Contact` type.
const newContact = await prisma.contact.create({
  data: {email: &#x27;john@example.com&#x27;},
});
</code></pre>
</li>
</ul>
<h1>Great! How Do I Share the Generated <code>@prisma/client</code> across Multiple Packages?</h1>
<p>Let&#x27;s say you have a monorepo workspace that is structured like this:</p>
<ul>
<li>Project Root<!-- -->
<ul>
<li>apps<!-- -->
<ul>
<li>dashboard</li>
</ul>
</li>
<li>libs<!-- -->
<ul>
<li>core</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>If you want to share the generated Prisma client, you can put your Prisma schema in a separate package like this:</p>
<ul>
<li>Project Root<!-- -->
<ul>
<li>apps<!-- -->
<ul>
<li>dashboard</li>
</ul>
</li>
<li>libs<!-- -->
<ul>
<li>core</li>
<li>shared-prisma<!-- -->
<ul>
<li>prisma<!-- -->
<ul>
<li>schema.prisma</li>
</ul>
</li>
<li>src<!-- -->
<ul>
<li>index.ts</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>After generating <code>@prisma/client</code> with <code>prisma generate</code> command, re-export the generated client from <code>libs/shared-prisma/src/index.ts</code> module:</p>
<pre><code class="language-ts">export * from &#x27;@prisma/client&#x27;;

// Optional: Create a Prisma client instance here.
import {PrismaClient} from &#x27;@prisma/client&#x27;;
export const prisma = new PrismaClient();
</code></pre>
<p>Now you can import shared Prisma client from other packages:</p>
<pre><code class="language-ts">import {prisma} from &#x27;@myscope/shared-prisma&#x27;;

const contacts = await prisma.contact.findMany();
</code></pre>
<h1>Caveats for Nx</h1>
<p>Unless you are using a <a href="https://nx.dev/structure/buildable-and-publishable-libraries">buildable or publishable</a> library,
all dependencies are installed to the workspace. This can be both good and bad depends on your needs:</p>
<ul>
<li>Good: you don&#x27;t need to re-export <code>@prisma/client</code> from <code>shared-prisma</code> because <code>@prisma/client</code> is installed to the workspace. All packages can access it already.</li>
<li>Bad: if you want to create multiple apps that has different Prisma schemas (thus different Prisma clients), Nx&#x27;s structure is not so great.
When you try to generate <code>@prisma/client</code> using different Prisma schemas, they all get installed to the central <code>@prisma/client</code> overwriting each other.
To solve this you need to make <code>shared-prisma</code> a buildable Nx library with its own <code>package.json</code> and <code>node_modules</code>.</li>
</ul></div><script src="/darkmode.js"></script></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"ckyjil4zl462609md50rnog8c","title":"Using Prisma in a Monorepo","content":"Prisma is an amazing ORM for TypeScript that allows you to access database in a completely type-safe way.\nThe developer experience Prisma provides can't be compared to anything else. In this article, you will learn how to use Prisma in a monorepo.\n\n# Brief Overview of How Prisma Works\nThere are two major concept in Prisma: [schema](https://www.prisma.io/docs/concepts/components/prisma-schema) and [client](https://www.prisma.io/docs/concepts/components/prisma-client)\n- Prisma schema is a text file describing the data models and database configurations. It looks like this:\n  ```\n  datasource db {\n    url      = env(\"DATABASE_URL\")\n    provider = \"postgresql\"\n  }\n\n  generator client {\n    provider = \"prisma-client-js\"\n  }\n\n  model Contact {\n    id        Int      @id @default(autoincrement())\n    createdAt DateTime @default(now())\n    email     String   @unique\n    name      String?\n  }\n  ```\n- From schema, Prisma generates a package called `@prisma/client` which provides type-safe interface to your models.\n  ```\n  import {PrismaClient} from '@prisma/client';\n  const prisma = new PrismaClient();\n\n  // This is inferred as `Contact` type.\n  const newContact = await prisma.contact.create({\n    data: {email: 'john@example.com'},\n  });\n  ```\n\n# Great! How Do I Share the Generated `@prisma/client` across Multiple Packages?\nLet's say you have a monorepo workspace that is structured like this:\n- Project Root\n  - apps\n    - dashboard\n  - libs\n    - core\n\nIf you want to share the generated Prisma client, you can put your Prisma schema in a separate package like this:\n- Project Root\n  - apps\n    - dashboard\n  - libs\n    - core\n    - shared-prisma\n      - prisma\n        - schema.prisma\n      - src\n        - index.ts\n\nAfter generating `@prisma/client` with `prisma generate` command, re-export the generated client from `libs/shared-prisma/src/index.ts` module:\n```ts\nexport * from '@prisma/client';\n\n// Optional: Create a Prisma client instance here.\nimport {PrismaClient} from '@prisma/client';\nexport const prisma = new PrismaClient();\n```\n\nNow you can import shared Prisma client from other packages:\n```ts\nimport {prisma} from '@myscope/shared-prisma';\n\nconst contacts = await prisma.contact.findMany();\n```\n\n# Caveats for Nx\nUnless you are using a [buildable or publishable](https://nx.dev/structure/buildable-and-publishable-libraries) library,\nall dependencies are installed to the workspace. This can be both good and bad depends on your needs:\n- Good: you don't need to re-export `@prisma/client` from `shared-prisma` because `@prisma/client` is installed to the workspace. All packages can access it already.\n- Bad: if you want to create multiple apps that has different Prisma schemas (thus different Prisma clients), Nx's structure is not so great.\n  When you try to generate `@prisma/client` using different Prisma schemas, they all get installed to the central `@prisma/client` overwriting each other.\n  To solve this you need to make `shared-prisma` a buildable Nx library with its own `package.json` and `node_modules`."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"ckyjil4zl462609md50rnog8c"},"buildId":"R2Z8peCXLRCkEcq9IzhX1","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>