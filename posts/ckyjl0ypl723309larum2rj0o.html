<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/83b7f8e18c18b5e5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/83b7f8e18c18b5e5.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-df4cf1c8d23aa877.js" defer=""></script><script src="/_next/static/chunks/framework-64e5798a40dd9493.js" defer=""></script><script src="/_next/static/chunks/main-f005fc0b72041078.js" defer=""></script><script src="/_next/static/chunks/pages/_app-59c42910bb166842.js" defer=""></script><script src="/_next/static/chunks/427-2baee4c8f3267812.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-c40e399344b2e7aa.js" defer=""></script><script src="/_next/static/zwa07DdzSGlo6I4Seog5P/_buildManifest.js" defer=""></script><script src="/_next/static/zwa07DdzSGlo6I4Seog5P/_ssgManifest.js" defer=""></script><script src="/_next/static/zwa07DdzSGlo6I4Seog5P/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css-global 5xmbmg">body{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;}a{color:#99B2DD;-webkit-text-decoration:none;text-decoration:none;}input[type="email"],input[type="text"],input[type="password"],select{box-shadow:none;border:none;padding:0.5rem;border-radius:0.25rem;background-color:#AA6373;outline:none;font-size:1rem;color:#F9DEC9;}button,input[type="submit"]{padding:1rem;font-weight:bold;text-transform:uppercase;color:#3A405A;background-color:#99B2DD;border:none;border-radius:0.25rem;cursor:pointer;}</style><style data-emotion="css 1p90b00">.css-1p90b00{min-height:100vh;color:#F9DEC9;background-color:#282C3E;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:2rem;}</style><div class="css-1p90b00"><style data-emotion="css 145hxoa">.css-145hxoa{position:-webkit-sticky;position:sticky;top:0;background:#3A405A;color:#F9DEC9;padding:1rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:0.5rem;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;box-shadow:rgba(0, 0, 0, 0.1) 0px 4px 12px;}</style><header class="css-145hxoa"><a href="/"><h1>danny.blog</h1></a></header><style data-emotion="css 31iok8">.css-31iok8{padding:0 3rem 3rem 3rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><main class="css-31iok8"><style data-emotion="css vsis0j">.css-vsis0j{font-size:3rem;color:#99B2DD;text-align:center;}</style><h1 class="css-vsis0j">모노리포에서 Prisma 사용하기</h1><style data-emotion="css wcom9c">.css-wcom9c{max-width:800px;-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;}.css-wcom9c p{margin-top:8px;}.css-wcom9c h1{color:#AA6373;margin-top:32px;}.css-wcom9c h2{color:#AA6373;margin-top:16px;border-bottom:3px solid;}.css-wcom9c h3{color:#AA6373;margin-top:16px;}.css-wcom9c ul,.css-wcom9c ol{margin-top:8px;padding-left:24px;}.css-wcom9c blockquote{color:#F9DEC9;background:#3A405A;box-shadow:rgba(0, 0, 0, 0.1) 0px 4px 12px;padding:0.5rem;margin:0.75rem 0;}.css-wcom9c blockquote p{margin:0;}.css-wcom9c pre{margin:0.75rem 0;overflow-x:auto;box-shadow:rgba(0, 0, 0, 0.1) 0px 4px 12px;}.css-wcom9c img{width:100%;}</style><div class="css-wcom9c"><p>프리즈마는 차원이 다른 개발자 경험을 제공하는 타입스크립트 ORM입니다. 대부분의 경우 프리즈마는 설정이 필요 없지만, 모노리포에 프리즈마를 추가하는 작업은 직관적이지 않을 수 있습니다.
이 포스트에서는 프리즈마를 모노리포 환경에서 사용하는 법을 다룹니다.<!-- --></p>
<!-- --><h1>간단한 프리즈마 소개<!-- --></h1>
<!-- --><p>프리즈마에는 크게 두가지 중��한 개념이 있습니다. <!-- --><a href="https://www.prisma.io/docs/concepts/components/prisma-schema">스키마<!-- --></a> 그리고 <!-- --><a href="https://www.prisma.io/docs/concepts/components/prisma-client">클라이언트<!-- --></a>인데요:<!-- --></p>
<!-- --><ul>
<!-- --><li>프리즈마 스키마는 데이터 모델과 데이터베이스 설정을 정의하는 텍스트 파일이며, 이렇게 생겼습니다:<!-- -->
<!-- --><pre><code>datasource db {
  url      = env(&quot;DATABASE_URL&quot;)
  provider = &quot;postgresql&quot;
}

generator client {
  provider = &quot;prisma-client-js&quot;
}

model Contact {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  email     String   @unique
  name      String?
}
<!-- --></code></pre>
<!-- --></li>
<!-- --><li>이 스키마를 이용해서 프리즈마는 <!-- --><code>@prisma/client<!-- --></code> 라는 패키지를 생성하는데, 이 패키지가 ORM의 타입지원과 기능을 제공합니다:<!-- -->
<!-- --><pre><code>import {PrismaClient} from &#x27;@prisma/client&#x27;;
const prisma = new PrismaClient();

// 자동으로 `Contact` 타입으로 유추됩니다.
const newContact = await prisma.contact.create({
  data: {email: &#x27;john@example.com&#x27;},
});
<!-- --></code></pre>
<!-- --></li>
<!-- --></ul>
<!-- --><h1>그렇다면 여러 패키지에서 하나의 <!-- --><code>@prisma/client<!-- --></code>를 돌려 쓰려면 어떻게 해야 하나요?<!-- --></h1>
<!-- --><p>모노리포 워크스페이스 구조가 이런 식으로 생겼다고 해봅시다:<!-- --></p>
<!-- --><ul>
<!-- --><li>Project Root<!-- -->
<!-- --><ul>
<!-- --><li>apps<!-- -->
<!-- --><ul>
<!-- --><li>dashboard<!-- --></li>
<!-- --></ul>
<!-- --></li>
<!-- --><li>libs<!-- -->
<!-- --><ul>
<!-- --><li>core<!-- --></li>
<!-- --></ul>
<!-- --></li>
<!-- --></ul>
<!-- --></li>
<!-- --></ul>
<!-- --><p>생성된 프리즈마 클라이언트를 공유하려면 일단 프리즈마 스키마를 별도의 패키지에 이렇게 집어넣습니다:<!-- --></p>
<!-- --><ul>
<!-- --><li>Project Root<!-- -->
<!-- --><ul>
<!-- --><li>apps<!-- -->
<!-- --><ul>
<!-- --><li>dashboard<!-- --></li>
<!-- --></ul>
<!-- --></li>
<!-- --><li>libs<!-- -->
<!-- --><ul>
<!-- --><li>core<!-- --></li>
<!-- --><li>shared-prisma<!-- -->
<!-- --><ul>
<!-- --><li>prisma<!-- -->
<!-- --><ul>
<!-- --><li>schema.prisma<!-- --></li>
<!-- --></ul>
<!-- --></li>
<!-- --><li>src<!-- -->
<!-- --><ul>
<!-- --><li>index.ts<!-- --></li>
<!-- --></ul>
<!-- --></li>
<!-- --></ul>
<!-- --></li>
<!-- --></ul>
<!-- --></li>
<!-- --></ul>
<!-- --></li>
<!-- --></ul>
<!-- --><p>이제 <!-- --><code>prisma generate<!-- --></code> 커맨드를 사용해서 <!-- --><code>@prisma/client<!-- --></code>를 생성하고, 그 생성된 클라이언트를 <!-- --><code>libs/shared-prisma/src/index.ts<!-- --></code> 모듈에서 re-export 해주면 됩니다:<!-- --></p>
<!-- --><pre><code class="language-ts">export * from &#x27;@prisma/client&#x27;;

// 선택사항: 프리즈마 ���스턴스를 여기에서 생성할 수도 있습니다.
import {PrismaClient} from &#x27;@prisma/client&#x27;;
export const prisma = new PrismaClient();
<!-- --></code></pre>
<!-- --><p>이렇게 설정해두면 다른 패키지에서 공유된 프리즈마 클라이언트를 import 할 수 있습니다.<!-- --></p>
<!-- --><pre><code class="language-ts">import {prisma} from &#x27;@myscope/shared-prisma&#x27;;

const contacts = await prisma.contact.findMany();
<!-- --></code></pre>
<!-- --><h1>Nx 사용��� 주의사항<!-- --></h1>
<!-- --><p><a href="https://nx.dev/structure/buildable-and-publishable-libraries">buildable 혹은 publishable<!-- --></a> 라이브러리를 사용하지 않는다면, 모든 의존성이 워크스페이스에 설치됩니다.
상황에 따라 이게 편할 수도 있지만 정말 불편할 수도 있습니다.<!-- --></p>
<!-- --><ul>
<!-- --><li>좋은 경우: <!-- --><code>@prisma/client<!-- --></code>가 워크스페이스에 설치되기 때문에 별도로 <!-- --><code>shared-prisma<!-- --></code>에서 re-export를 할 필요가 없습니다. 모든 패키지에서 이미 <!-- --><code>@prisma/client<!-- --></code>에 접근 가능합니다.<!-- --></li>
<!-- --><li>안좋은 경우: 모노리포 안에 서로 다른 프리즈마 스키마를 (따라서 다른 프리즈마 클라이언트를) 사용하는 앱이 여러개 있는 경우, Nx의 이러한 구조가 골치아픕니다.
각각의 프리즈마 스키마에서 <!-- --><code>@prisma/client<!-- --></code>를 생��할 때마다 전부 워크스페이스의 <!-- --><code>@prisma/client<!-- --></code>를 덮어쓰기 때문입니다.
이 문제를 해결하기 위해서는 <!-- --><code>shared-prisma<!-- --></code>를 독립적인 <!-- --><code>package.json<!-- --></code>과 <!-- --><code>node_modules<!-- --></code>를 가진 buildable Nx 라이브러리로 만들어줘야합니다.<!-- --></li>
<!-- --></ul></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"ckyjl0ypl723309larum2rj0o","title":"모노리포에서 Prisma 사용하기","content":"프리즈마는 차원이 다른 개발자 경험을 제공하는 타입스크립트 ORM입니다. 대부분의 경우 프리즈마는 설정이 필요 없지만, 모노리포에 프리즈마를 추가하는 작업은 직관적이지 않을 수 있습니다.\n이 포스트에서는 프리즈마를 모노리포 환경에서 사용하는 법을 다룹니다.\n\n# 간단한 프리즈마 소개\n프리즈마에는 크게 두가지 중요한 개념이 있습니다. [스키마](https://www.prisma.io/docs/concepts/components/prisma-schema) 그리고 [클라이언트](https://www.prisma.io/docs/concepts/components/prisma-client)인데요:\n- 프리즈마 스키마는 데이터 모델과 데이터베이스 설정을 정의하는 텍스트 파일이며, 이렇게 생겼습니다:\n  ```\n  datasource db {\n    url      = env(\"DATABASE_URL\")\n    provider = \"postgresql\"\n  }\n\n  generator client {\n    provider = \"prisma-client-js\"\n  }\n\n  model Contact {\n    id        Int      @id @default(autoincrement())\n    createdAt DateTime @default(now())\n    email     String   @unique\n    name      String?\n  }\n  ```\n- 이 스키마를 이용해서 프리즈마는 `@prisma/client` 라는 패키지를 생성하는데, 이 패키지가 ORM의 타입지원과 기능을 제공합니다:\n  ```\n  import {PrismaClient} from '@prisma/client';\n  const prisma = new PrismaClient();\n\n  // 자동으로 `Contact` 타입으로 유추됩니다.\n  const newContact = await prisma.contact.create({\n    data: {email: 'john@example.com'},\n  });\n  ```\n\n# 그렇다면 여러 패키지에서 하나의 `@prisma/client`를 돌려 쓰려면 어떻게 해야 하나요?\n모노리포 워크스페이스 구조가 이런 식으로 생겼다고 해봅시다:\n- Project Root\n  - apps\n    - dashboard\n  - libs\n    - core\n\n생성된 프리즈마 클라이언트를 공유하려면 일단 프리즈마 스키마를 별도의 패키지에 이렇게 집어넣습니다:\n- Project Root\n  - apps\n    - dashboard\n  - libs\n    - core\n    - shared-prisma\n      - prisma\n        - schema.prisma\n      - src\n        - index.ts\n\n이제 `prisma generate` 커맨드를 사용해서 `@prisma/client`를 생성하고, 그 생성된 클라이언트를 `libs/shared-prisma/src/index.ts` 모듈에서 re-export 해주면 됩니다:\n```ts\nexport * from '@prisma/client';\n\n// 선택사항: 프리즈마 인스턴스를 여기에서 생성할 수도 있습니다.\nimport {PrismaClient} from '@prisma/client';\nexport const prisma = new PrismaClient();\n```\n\n이렇게 설정해두면 다른 패키지에서 공유된 프리즈마 클라이언트를 import 할 수 있습니다.\n```ts\nimport {prisma} from '@myscope/shared-prisma';\n\nconst contacts = await prisma.contact.findMany();\n```\n\n# Nx 사용시 주의사항\n[buildable 혹은 publishable](https://nx.dev/structure/buildable-and-publishable-libraries) 라이브러리를 사용하지 않는다면, 모든 의존성이 워크스페이스에 설치됩니다.\n상황에 따라 이게 편할 수도 있지만 정말 불편할 수도 있습니다.\n- 좋은 경우: `@prisma/client`가 워크스페이스에 설치되기 때문에 별도로 `shared-prisma`에서 re-export를 할 필요가 없습니다. 모든 패키지에서 이미 `@prisma/client`에 접근 가능합니다.\n- 안좋은 경우: 모노리포 안에 서로 다른 프리즈마 스키마를 (따라서 다른 프리즈마 클라이언트를) 사용하는 앱이 여러개 있는 경우, Nx의 이러한 구조가 골치아픕니다.\n  각각의 프리즈마 스키마에서 `@prisma/client`를 생성할 때마다 전부 워크스페이스의 `@prisma/client`를 덮어쓰기 때문입니다.\n  이 문제를 해결하기 위해서는 `shared-prisma`를 독립적인 `package.json`과 `node_modules`를 가진 buildable Nx 라이브러리로 만들어줘야합니다."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"ckyjl0ypl723309larum2rj0o"},"buildId":"zwa07DdzSGlo6I4Seog5P","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>